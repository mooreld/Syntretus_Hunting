# Identifying Syntretus infections
Several thousands of insects are sampled from the wild each year to have their genomes sequenced. Often, these wild-caught insects will also be carrying 'passengers' (e.g. viruses, microbial symbionts and parasites). During the sequencing process the genomic material of these 'passengers will be mixed with genomic material of their host. These intended or unintended sequencing outcomes can be a treasure trove for researchers who study host-symbiont or host-parasite relationships as it can provide not only sequencing data of the infecing organism, but also provide insights into host range and geographic range of the 'passenger' of interest. For the purposes of this study, _Syntretus_ [Braconidae:Euphorinae] wasp infections were identified in publically available sequence read data sets of two known potential hosts including _Drosophila_ and _Apis_ _cerana_. 

Due to the sheer number of SRA files to explore and their large file sizes, it was inefficient to do individual blast searches of each SRA file. Instead, a 'while loop' is used to take a list of SRA accessions in a .txt file and download each individually to then be screened for _Syntretus_ markers. More specifically, the code uses the fasterq-dump function of ncbi-sra/3.0.2 to upload the next SRA accession in the list. The uploaded SRA read file is then passed to BBmap/38.35 software where the reads are mapped against both the host mitochondrial genome and the _Syntretus perlmani_ mitochondrial genome. The outputs of BBmap/38.35 are coverage statistics and mapped reads. Once the mapping is finished, the SRA read file is deleted to make room for the next file in queue. As the 'while loop' implies, this continues up until the last SRA accession in the list.

Coverage statistics outputs (i.e. covstats) were reviewed to determine if any reads mapped to the _Syntretus_ mitochondrial genome. All positive hits are further investigated with sequence analysis software (e.g. Geneious)
 
This code can be adapted to search for any foreign reads within a series of sequence read sets so long as 1) the user has a series of SRA accessions they want to investigate and 2) the user has a DNA reference for the infecting organism of interest (e.g. we use mitochondrial DNA).

Three folders containing code, SRA accessions and mitochondrial references can be found in this repository. Each folder and its purpose are described below. 

Required bioinformatic tools for these codes include BBmap/38.35 and ncbi-sra/3.0.2 (or most up to date versions). The installation guide for BBmap can be found at https://jgi.doe.gov/data-and-tools/software-tools/bbtools/bb-tools-user-guide/installation-guide/ and the installation guide for SRA toolkit (ncbi-sra/3.0.2) can be found at https://github.com/ncbi/sra-tools/wiki/02.-Installing-SRA-Toolkit.

## Drosophila_Syntretus_Mapping Folder
This folder includes the code (Drosophila_Syntretus_mapping.sh), the list of SRA accessions (DEST_SRA.txt), and the mitochondrial genomes of both _Syntretus perlmani_ and _Drosophila melanogaster_ (Drosophila_Syntretus_Mitochondria.fasta). The _Drosophila melanogaster_ mitochondrial genome is included in the mapping process to act as a positive control. All SRA reads were acquired from **Drosophila Evolution over Space and Time** databse published by Kapun et al., 2021. The code takes over a week to go through all the DEST SRA accessions. If the user is just interested in read sets that possess _Syntretus_ reads, then they can refer to Supplementary Data Table S5 which lists those specific accessions.

When _Syntretus_ reads are identified within a _Drosophila_ read set, the SRA read files are re-downloaded and re-run through BBmap software again with the minratio still set at .90 but using only the _Syntretus perlmani_ mitochondrial genome as the reference sequence (i.e. not _Syntretus perlmani_ **and** _Drosophila melanogaster_ as we did in the first run). This results in a mapping ouput of just _Syntretus_ reads. _Drosophila_ reads are not included in this final output because the sequence similarity between _Syntretus_ and _Drosophila_ is so low. 

## Apis_Syntretus_Mapping Folder
This folder includes the code (Apis_Syntretus_mapping.sh), the list of SRA accessions (Apis_cerana_SRA.txt), and the mitochondrial genomes of both _Syntretus perlmani_ and _Apis cerana_ (Apis_Syntretus_Mitochondria.fasta). The _Apis cerana_ mitochondrial genome is included in the mapping process to act as a positive control.

In the case of 'Drosophila_Syntretus_Mapping', _Syntretus_ reads were extracted by mapping the sequence read sets using only the _Syntretus_ mitochondrial genome as the reference sequence. This could be done without concern of also having _Drosophila_ reads in the final output because there is low sequence similarity between _Drosophila_ and _Syntretus_. However, in this particular case _Apis_ and _Syntretus_ both belong to the order Hymenoptera and are more likely to possess regions of high similarity. Additionally, the _Syntretus_ species that infects _Apis cerana_ is genetically divergent from the species _Syntretus perlmani_ and therefor, a lower minratio threshold is required for mapping. For these reasons, a simple two step mapping process is taken to exclude _Apis_ reads from the final _Syntretus_ mapping ouput which is described in the final folder 'Apis_Syntretus_Mapping_Sensitive'. 

## Apis_Syntretus_Mapping_Sensitive Folder
This folder includes the code (Apis_sensitive_mapping.sh), the _Apis cerana_ mitochondrial genome (Apis_cerana_mitochondria.fasta), and the _Syntretus perlmani_ mitochondrial genome (Syntretus_perlmani_mitochondria.fasta). Due to the similarities between the _Syntretus_ and _Apis_ mitochondrial genomes, the mapping process is seperated into two steps. The first step maps reads with a high threshold for similarity (minratio=.95) to just the _Apis cerana_ mitochondrial genome and outputs 'unmapped reads' only. The second step maps the 'unmappped reads' against the _Syntretus perlmani_ mitochondrial genome with a low threshold for similarity (minratio=.50) and outputs 'mapped reads' only. This final 'mapped reads' output consists of almost entirely reads belonging to _Syntretus_.
